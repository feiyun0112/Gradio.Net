{"version":3,"file":"FileUpload-DuOK37gs.js","sources":["../../../../js/file/shared/utils.ts","../../../../js/file/shared/FilePreview.svelte","../../../../js/file/shared/File.svelte","../../../../js/file/shared/FileUpload.svelte"],"sourcesContent":["import type { FileData } from \"@gradio/client\";\n\nexport const prettyBytes = (bytes: number): string => {\n\tlet units = [\"B\", \"KB\", \"MB\", \"GB\", \"PB\"];\n\tlet i = 0;\n\twhile (bytes > 1024) {\n\t\tbytes /= 1024;\n\t\ti++;\n\t}\n\tlet unit = units[i];\n\treturn bytes.toFixed(1) + \"&nbsp;\" + unit;\n};\n","<script lang=\"ts\">\n\timport type { FileData } from \"@gradio/client\";\n\timport { prettyBytes } from \"./utils\";\n\timport { createEventDispatcher } from \"svelte\";\n\timport type { I18nFormatter, SelectData } from \"@gradio/utils\";\n\timport { DownloadLink } from \"@gradio/wasm/svelte\";\n\n\tconst dispatch = createEventDispatcher<{\n\t\tselect: SelectData;\n\t\tchange: FileData[] | FileData;\n\t\tdelete: FileData;\n\t\tdownload: FileData;\n\t}>();\n\texport let value: FileData | FileData[];\n\texport let selectable = false;\n\texport let height: number | undefined = undefined;\n\texport let i18n: I18nFormatter;\n\n\tfunction split_filename(filename: string): [string, string] {\n\t\tconst last_dot = filename.lastIndexOf(\".\");\n\t\tif (last_dot === -1) {\n\t\t\treturn [filename, \"\"];\n\t\t}\n\t\treturn [filename.slice(0, last_dot), filename.slice(last_dot)];\n\t}\n\n\t$: normalized_files = (Array.isArray(value) ? value : [value]).map((file) => {\n\t\tconst [filename_stem, filename_ext] = split_filename(file.orig_name ?? \"\");\n\t\treturn {\n\t\t\t...file,\n\t\t\tfilename_stem,\n\t\t\tfilename_ext\n\t\t};\n\t});\n\n\tfunction handle_row_click(\n\t\tevent: MouseEvent & { currentTarget: HTMLTableRowElement },\n\t\tindex: number\n\t): void {\n\t\tconst tr = event.currentTarget;\n\t\tconst should_select =\n\t\t\tevent.target === tr || // Only select if the click is on the row itself\n\t\t\t(tr &&\n\t\t\t\ttr.firstElementChild &&\n\t\t\t\tevent.composedPath().includes(tr.firstElementChild)); // Or if the click is on the name column\n\n\t\tif (should_select) {\n\t\t\tdispatch(\"select\", { value: normalized_files[index].orig_name, index });\n\t\t}\n\t}\n\n\tfunction remove_file(index: number): void {\n\t\tconst removed = normalized_files.splice(index, 1);\n\t\tnormalized_files = [...normalized_files];\n\t\tvalue = normalized_files;\n\t\tdispatch(\"delete\", removed[0]);\n\t\tdispatch(\"change\", normalized_files);\n\t}\n\n\tfunction handle_download(file: FileData): void {\n\t\tdispatch(\"download\", file);\n\t}\n\n\tconst is_browser = typeof window !== \"undefined\";\n</script>\n\n<div\n\tclass=\"file-preview-holder\"\n\tstyle=\"max-height: {typeof height === undefined ? 'auto' : height + 'px'};\"\n>\n\t<table class=\"file-preview\">\n\t\t<tbody>\n\t\t\t{#each normalized_files as file, i (file)}\n\t\t\t\t<tr\n\t\t\t\t\tclass=\"file\"\n\t\t\t\t\tclass:selectable\n\t\t\t\t\ton:click={(event) => {\n\t\t\t\t\t\thandle_row_click(event, i);\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t<td class=\"filename\" aria-label={file.orig_name}>\n\t\t\t\t\t\t<span class=\"stem\">{file.filename_stem}</span>\n\t\t\t\t\t\t<span class=\"ext\">{file.filename_ext}</span>\n\t\t\t\t\t</td>\n\n\t\t\t\t\t<td class=\"download\">\n\t\t\t\t\t\t{#if file.url}\n\t\t\t\t\t\t\t<DownloadLink\n\t\t\t\t\t\t\t\thref={file.url}\n\t\t\t\t\t\t\t\ton:click={() => handle_download(file)}\n\t\t\t\t\t\t\t\tdownload={is_browser && window.__is_colab__\n\t\t\t\t\t\t\t\t\t? null\n\t\t\t\t\t\t\t\t\t: file.orig_name}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{@html file.size != null\n\t\t\t\t\t\t\t\t\t? prettyBytes(file.size)\n\t\t\t\t\t\t\t\t\t: \"(size unknown)\"}&nbsp;&#8675;\n\t\t\t\t\t\t\t</DownloadLink>\n\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t{i18n(\"file.uploading\")}\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</td>\n\n\t\t\t\t\t{#if normalized_files.length > 1}\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass=\"label-clear-button\"\n\t\t\t\t\t\t\t\taria-label=\"Remove this file\"\n\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\tremove_file(i);\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\ton:keydown={(event) => {\n\t\t\t\t\t\t\t\t\tif (event.key === \"Enter\") {\n\t\t\t\t\t\t\t\t\t\tremove_file(i);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t>Ã—\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t{/if}\n\t\t\t\t</tr>\n\t\t\t{/each}\n\t\t</tbody>\n\t</table>\n</div>\n\n<style>\n\t.label-clear-button {\n\t\tcolor: var(--body-text-color-subdued);\n\t\tposition: relative;\n\t\tleft: -3px;\n\t}\n\n\t.label-clear-button:hover {\n\t\tcolor: var(--body-text-color);\n\t}\n\n\t.file-preview {\n\t\ttable-layout: fixed;\n\t\twidth: var(--size-full);\n\t\tmax-height: var(--size-60);\n\t\toverflow-y: auto;\n\t\tmargin-top: var(--size-1);\n\t\tcolor: var(--body-text-color);\n\t}\n\n\t.file-preview-holder {\n\t\toverflow: auto;\n\t}\n\n\t.file {\n\t\tdisplay: flex;\n\t\twidth: var(--size-full);\n\t}\n\n\t.file > * {\n\t\tpadding: var(--size-1) var(--size-2-5);\n\t}\n\n\t.filename {\n\t\tflex-grow: 1;\n\t\tdisplay: flex;\n\t\toverflow: hidden;\n\t}\n\t.filename .stem {\n\t\toverflow: hidden;\n\t\ttext-overflow: ellipsis;\n\t\twhite-space: nowrap;\n\t}\n\t.filename .ext {\n\t\twhite-space: nowrap;\n\t}\n\n\t.download {\n\t\tmin-width: 8rem;\n\t\twidth: 10%;\n\t\twhite-space: nowrap;\n\t\ttext-align: right;\n\t}\n\t.download:hover {\n\t\ttext-decoration: underline;\n\t}\n\t.download > :global(a) {\n\t\tcolor: var(--link-text-color);\n\t}\n\n\t.download > :global(a:hover) {\n\t\tcolor: var(--link-text-color-hover);\n\t}\n\t.download > :global(a:visited) {\n\t\tcolor: var(--link-text-color-visited);\n\t}\n\t.download > :global(a:active) {\n\t\tcolor: var(--link-text-color-active);\n\t}\n\t.selectable {\n\t\tcursor: pointer;\n\t}\n\n\ttbody > tr:nth-child(even) {\n\t\tbackground: var(--block-background-fill);\n\t}\n\n\ttbody > tr:nth-child(odd) {\n\t\tbackground: var(--table-odd-background-fill);\n\t}\n</style>\n","<script lang=\"ts\">\n\timport type { FileData } from \"@gradio/client\";\n\timport { BlockLabel, Empty } from \"@gradio/atoms\";\n\timport { File } from \"@gradio/icons\";\n\timport FilePreview from \"./FilePreview.svelte\";\n\timport type { I18nFormatter } from \"@gradio/utils\";\n\n\texport let value: FileData | FileData[] | null = null;\n\texport let label: string;\n\texport let show_label = true;\n\texport let selectable = false;\n\texport let height: number | undefined = undefined;\n\texport let i18n: I18nFormatter;\n</script>\n\n<BlockLabel\n\t{show_label}\n\tfloat={value === null}\n\tIcon={File}\n\tlabel={label || \"File\"}\n/>\n\n{#if value && (Array.isArray(value) ? value.length > 0 : true)}\n\t<FilePreview {i18n} {selectable} on:select on:download {value} {height} />\n{:else}\n\t<Empty unpadded_box={true} size=\"large\"><File /></Empty>\n{/if}\n","<script lang=\"ts\">\n\timport { createEventDispatcher, tick } from \"svelte\";\n\timport { Upload, ModifyUpload } from \"@gradio/upload\";\n\timport type { FileData, Client } from \"@gradio/client\";\n\timport { BlockLabel, IconButtonWrapper, IconButton } from \"@gradio/atoms\";\n\timport { File, Clear, Upload as UploadIcon } from \"@gradio/icons\";\n\n\timport FilePreview from \"./FilePreview.svelte\";\n\timport type { I18nFormatter } from \"@gradio/utils\";\n\n\texport let value: null | FileData | FileData[];\n\n\texport let label: string;\n\texport let show_label = true;\n\texport let file_count: \"single\" | \"multiple\" | \"directory\" = \"single\";\n\texport let file_types: string[] | null = null;\n\texport let selectable = false;\n\texport let root: string;\n\texport let height: number | undefined = undefined;\n\texport let i18n: I18nFormatter;\n\texport let max_file_size: number | null = null;\n\texport let upload: Client[\"upload\"];\n\texport let stream_handler: Client[\"stream\"];\n\texport let uploading = false;\n\n\tasync function handle_upload({\n\t\tdetail\n\t}: CustomEvent<FileData | FileData[]>): Promise<void> {\n\t\tif (Array.isArray(value)) {\n\t\t\tvalue = [...value, ...(Array.isArray(detail) ? detail : [detail])];\n\t\t} else if (value) {\n\t\t\tvalue = [value, ...(Array.isArray(detail) ? detail : [detail])];\n\t\t} else {\n\t\t\tvalue = detail;\n\t\t}\n\t\tawait tick();\n\t\tdispatch(\"change\", value);\n\t\tdispatch(\"upload\", detail);\n\t}\n\n\tfunction handle_clear(): void {\n\t\tvalue = null;\n\t\tdispatch(\"change\", null);\n\t\tdispatch(\"clear\");\n\t}\n\n\tconst dispatch = createEventDispatcher<{\n\t\tchange: FileData[] | FileData | null;\n\t\tclear: undefined;\n\t\tdrag: boolean;\n\t\tupload: FileData[] | FileData;\n\t\tload: FileData[] | FileData;\n\t\terror: string;\n\t}>();\n\n\tlet dragging = false;\n\t$: dispatch(\"drag\", dragging);\n</script>\n\n<BlockLabel {show_label} Icon={File} float={!value} label={label || \"File\"} />\n\n{#if value && (Array.isArray(value) ? value.length > 0 : true)}\n\t<IconButtonWrapper>\n\t\t<IconButton Icon={UploadIcon} label={i18n(\"common.upload\")}>\n\t\t\t<Upload\n\t\t\t\ticon_upload={true}\n\t\t\t\ton:load={handle_upload}\n\t\t\t\tfiletype={file_types}\n\t\t\t\t{file_count}\n\t\t\t\t{max_file_size}\n\t\t\t\t{root}\n\t\t\t\tbind:dragging\n\t\t\t\tbind:uploading\n\t\t\t\ton:error\n\t\t\t\t{stream_handler}\n\t\t\t\t{upload}\n\t\t\t/>\n\t\t</IconButton>\n\t\t<IconButton\n\t\t\tIcon={Clear}\n\t\t\tlabel={i18n(\"common.clear\")}\n\t\t\ton:click={(event) => {\n\t\t\t\tdispatch(\"clear\");\n\t\t\t\tevent.stopPropagation();\n\t\t\t\thandle_clear();\n\t\t\t}}\n\t\t/>\n\t</IconButtonWrapper>\n\n\t<FilePreview\n\t\t{i18n}\n\t\ton:select\n\t\t{selectable}\n\t\t{value}\n\t\t{height}\n\t\ton:change\n\t\ton:delete\n\t/>\n{:else}\n\t<Upload\n\t\ton:load={handle_upload}\n\t\tfiletype={file_types}\n\t\t{file_count}\n\t\t{max_file_size}\n\t\t{root}\n\t\tbind:dragging\n\t\tbind:uploading\n\t\ton:error\n\t\t{stream_handler}\n\t\t{upload}\n\t>\n\t\t<slot />\n\t</Upload>\n{/if}\n"],"names":["prettyBytes","bytes","units","i","unit","t_value","ctx","dirty","set_data","t","downloadlink_changes","html_tag","raw_value","insert","target","td","anchor","append","button","t0_value","t2_value","create_if_block","attr","td0","td0_aria_label_value","tr","span0","span1","td1","current","t0","t2","set_style","div","table","tbody","split_filename","filename","last_dot","dispatch","createEventDispatcher","value","$$props","selectable","height","i18n","handle_row_click","event","index","normalized_files","remove_file","removed","$$invalidate","handle_download","file","is_browser","click_handler","filename_stem","filename_ext","File","show_if","blocklabel_changes","label","show_label","tick","UploadIcon","Clear","iconbutton0_changes","iconbutton1_changes","file_count","file_types","root","max_file_size","upload","stream_handler","uploading","handle_upload","detail","handle_clear","dragging"],"mappings":"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"}