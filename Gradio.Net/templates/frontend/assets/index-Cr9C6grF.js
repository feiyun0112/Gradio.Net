const __vite__fileDeps=["./eventsource-CfQQVHjX.js","./_commonjsHelpers-BosuxZz1.js","./url-BybKzMWq.js","./__vite-browser-external-DFe-p4yY.js","./wrapper-CviSselG-DCvi549i.js","./Index-CLipTJLN.js","./Index-BzauI1Pb.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import*as Z from"./svelte/svelte.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function t(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(n){if(n.ep)return;n.ep=!0;const o=t(n);fetch(n.href,o)}})();const ke="modulepreload",Ae=function(e,s){return new URL(e,s).href},ue={},J=function(s,t,r){let n=Promise.resolve();if(t&&t.length>0){const o=document.getElementsByTagName("link"),i=document.querySelector("meta[property=csp-nonce]"),a=i?.nonce||i?.getAttribute("nonce");n=Promise.all(t.map(u=>{if(u=Ae(u,r),u in ue)return;ue[u]=!0;const c=u.endsWith(".css"),d=c?'[rel="stylesheet"]':"";if(!!r)for(let h=o.length-1;h>=0;h--){const w=o[h];if(w.href===u&&(!c||w.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${u}"]${d}`))return;const l=document.createElement("link");if(l.rel=c?"stylesheet":ke,c||(l.as="script",l.crossOrigin=""),l.href=u,a&&l.setAttribute("nonce",a),document.head.appendChild(l),c)return new Promise((h,w)=>{l.addEventListener("load",h),l.addEventListener("error",()=>w(new Error(`Unable to preload CSS for ${u}`)))})}))}return n.then(()=>s()).catch(o=>{const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=o,window.dispatchEvent(i),!i.defaultPrevented)throw o})};var Pe=Object.defineProperty,Te=(e,s,t)=>s in e?Pe(e,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[s]=t,m=(e,s,t)=>(Te(e,typeof s!="symbol"?s+"":s,t),t),ee=new Intl.Collator(0,{numeric:1}).compare;function _e(e,s,t){return e=e.split("."),s=s.split("."),ee(e[0],s[0])||ee(e[1],s[1])||(s[2]=s.slice(2).join("."),t=/[.-]/.test(e[2]=e.slice(2).join(".")),t==/[.-]/.test(s[2])?ee(e[2],s[2]):t?-1:1)}const Re="upload",Ne="config",De="info",je="runtime",qe="sleeptime",xe="https://gradio-space-api-fetcher-v2.hf.space/api",me="This application is currently busy. Please try again. ",z="Connection errored out. ",F="Could not resolve app config. ",Le="Could not get space status. ",Ie="Could not get API info. ",Ue="Space metadata could not be loaded. ";function ge(e,s,t){return s.startsWith("http://")||s.startsWith("https://")?t?e:s:e+s}async function ze(e,s){try{return(await(await fetch(`https://huggingface.co/api/spaces/${e}/jwt`,{headers:{Authorization:`Bearer ${s}`}})).json()).token||!1}catch{return!1}}function Be(e){let s={};return e.forEach(({apiName:t},r)=>{t&&(s[t]=r)}),s}async function Fe(e){const s=this.options.hf_token?{Authorization:`Bearer ${this.options.hf_token}`}:{};if(s["Content-Type"]="application/json",typeof window<"u"&&window.gradio_config&&location.origin!=="http://localhost:9876"&&!window.gradio_config.dev_mode){const t=window.gradio_config.root,r=window.gradio_config;let n=ge(e,r.root,!1);return r.root=n,{...r,path:t}}else if(e){const t=await this.fetch(`${e}/${Ne}`,{headers:s});if(t?.status===200){let r=await t.json();return r.path=r.path??"",r.root=e,r}throw new Error(F)}throw new Error(F)}function te(e){if(e.startsWith("http")){const{protocol:s,host:t}=new URL(e);return t.endsWith("hf.space")?{ws_protocol:"wss",host:t,http_protocol:s}:{ws_protocol:s==="https:"?"wss":"ws",http_protocol:s,host:t}}else if(e.startsWith("file:"))return{ws_protocol:"ws",http_protocol:"http:",host:"lite.local"};return{ws_protocol:"wss",http_protocol:"https:",host:e}}const we=/^[^\/]*\/[^\/]*$/,Me=/.*hf\.space\/{0,1}$/;async function ye(e,s){const t={};s&&(t.Authorization=`Bearer ${s}`);const r=e.trim();if(we.test(r))try{const o=(await(await fetch(`https://huggingface.co/api/spaces/${r}/host`,{headers:t})).json()).host;return{space_id:e,...te(o)}}catch(n){throw new Error("Space metadata could not be loaded. "+n.message)}if(Me.test(r)){const{ws_protocol:n,http_protocol:o,host:i}=te(r);return{space_id:i.replace(".hf.space",""),ws_protocol:n,http_protocol:o,host:i}}return{space_id:!1,...te(r)}}function Ge(e,s,t){const r={named_endpoints:{},unnamed_endpoints:{}};return Object.keys(e).forEach(n=>{(n==="named_endpoints"||n==="unnamed_endpoints")&&(r[n]={},Object.entries(e[n]).forEach(([o,{parameters:i,returns:a}])=>{var u,c;const d=s.dependencies.findIndex(h=>h.apiName===o||h.apiName===o.replace("/",""))||t[o.replace("/","")]||-1,p=d!==-1?s.dependencies[d].types:{continuous:!1,generator:!1};if(d!==-1&&((c=(u=s.dependencies[d])==null?void 0:u.inputs)==null?void 0:c.length)!==i.length){const h=s.dependencies[d].inputs.map(w=>{var b;return(b=s.components.find(T=>T.id===w))==null?void 0:b.type});try{h.forEach((w,b)=>{if(w==="state"){const T={component:"state",example:null,parameter_default:null,parameter_has_default:!0,parameter_name:null,hidden:!0};i.splice(b,0,T)}})}catch{}}const l=(h,w,b,T)=>({...h,description:We(h?.type,b),type:Je(h?.type,w,b,T)||""});r[n][o]={parameters:i.map(h=>l(h,h?.component,h?.serializer,"parameter")),returns:a.map(h=>l(h,h?.component,h?.serializer,"return")),type:p}}))}),r}function Je(e,s,t,r){switch(e?.type){case"string":return"string";case"boolean":return"boolean";case"number":return"number"}if(t==="JSONSerializable"||t==="StringSerializable")return"any";if(t==="ListStringSerializable")return"string[]";if(s==="Image")return r==="parameter"?"Blob | File | Buffer":"string";if(t==="FileSerializable")return e?.type==="array"?r==="parameter"?"(Blob | File | Buffer)[]":"{ name: string; data: string; size?: number; is_file?: boolean; orig_name?: string}[]":r==="parameter"?"Blob | File | Buffer":"{ name: string; data: string; size?: number; is_file?: boolean; orig_name?: string}";if(t==="GallerySerializable")return r==="parameter"?"[(Blob | File | Buffer), (string | null)][]":"[{ name: string; data: string; size?: number; is_file?: boolean; orig_name?: string}, (string | null))][]"}function We(e,s){return s==="GallerySerializable"?"array of [file, label] tuples":s==="ListStringSerializable"?"array of strings":s==="FileSerializable"?"array of files or single file":e?.description}function se(e,s){switch(e.msg){case"send_data":return{type:"data"};case"send_hash":return{type:"hash"};case"queue_full":return{type:"update",status:{queue:!0,message:me,stage:"error",code:e.code,success:e.success}};case"heartbeat":return{type:"heartbeat"};case"unexpected_error":return{type:"unexpected_error",status:{queue:!0,message:e.message,stage:"error",success:!1}};case"estimation":return{type:"update",status:{queue:!0,stage:s||"pending",code:e.code,size:e.queue_size,position:e.rank,eta:e.rank_eta,success:e.success}};case"progress":return{type:"update",status:{queue:!0,stage:"pending",code:e.code,progress_data:e.progress_data,success:e.success}};case"log":return{type:"log",data:e};case"process_generating":return{type:"generating",status:{queue:!0,message:e.success?null:e.output.error,stage:e.success?"generating":"error",code:e.code,progress_data:e.progress_data,eta:e.average_duration},data:e.success?e.output:null};case"process_completed":return"error"in e.output?{type:"update",status:{queue:!0,message:e.output.error,stage:"error",code:e.code,success:e.success}}:{type:"complete",status:{queue:!0,message:e.success?void 0:e.output.error,stage:e.success?"complete":"error",code:e.code,progress_data:e.progress_data},data:e.success?e.output:null};case"process_starts":return{type:"update",status:{queue:!0,stage:"pending",code:e.code,size:e.rank,position:0,success:e.success,eta:e.eta}}}return{type:"none",status:{stage:"error",queue:!0}}}const He=(e,s)=>{const t=Object.values(s.named_endpoints).flatMap(o=>o.parameters);if(Array.isArray(e))return e.length>t.length&&console.warn("Too many arguments provided for the endpoint."),e;const r=[],n=Object.keys(e);return t.forEach((o,i)=>{if(e.hasOwnProperty(o.parameter_name))r[i]=e[o.parameter_name];else if(o.parameter_has_default)r[i]=o.parameter_default;else throw new Error(`No value provided for required parameter: ${o.parameter_name}`)}),n.forEach(o=>{if(!t.some(i=>i.parameter_name===o))throw new Error(`Parameter \`${o}\` is not a valid keyword argument. Please refer to the API for usage.`)}),r.forEach((o,i)=>{if(o===void 0&&!t[i].parameter_has_default)throw new Error(`No value provided for required parameter: ${t[i].parameter_name}`)}),r};async function Ke(){if(this.api_info)return this.api_info;const{hf_token:e}=this.options,{config:s}=this,t={"Content-Type":"application/json"};if(e&&(t.Authorization=`Bearer ${e}`),!!s)try{let r;if(_e(s?.version||"2.0.0","3.30")<0?r=await this.fetch(xe,{method:"POST",body:JSON.stringify({serialize:!1,config:JSON.stringify(s)}),headers:t}):r=await this.fetch(`${s?.root}/${De}`,{headers:t}),!r.ok)throw new Error(z);let n=await r.json();return"api"in n&&(n=n.api),n.named_endpoints["/predict"]&&!n.unnamed_endpoints[0]&&(n.unnamed_endpoints[0]=n.named_endpoints["/predict"]),Ge(n,s,this.api_map)}catch(r){""+r.message}}async function Ve(e,s,t){var r;const n={};(r=this==null?void 0:this.options)!=null&&r.hf_token&&(n.Authorization=`Bearer ${this.options.hf_token}`);const o=1e3,i=[];let a;for(let u=0;u<s.length;u+=o){const c=s.slice(u,u+o),d=new FormData;c.forEach(l=>{d.append("files",l)});try{const l=t?`${e}/upload?upload_id=${t}`:`${e}/${Re}`;a=await this.fetch(l,{method:"POST",body:d,headers:n})}catch(l){throw new Error(z+l.message)}if(!a.ok){const l=await a.text();return{error:`HTTP ${a.status}: ${l}`}}const p=await a.json();p&&i.push(...p)}return{files:i}}async function Ye(e,s,t,r){let n=(Array.isArray(e)?e:[e]).map(i=>i.blob);const o=n.filter(i=>i.size>(r??1/0));if(o.length)throw new Error(`File size exceeds the maximum allowed size of ${r} bytes: ${o.map(i=>i.name).join(", ")}`);return await Promise.all(await this.upload_files(s,n,t).then(async i=>{if(i.error)throw new Error(i.error);return i.files?i.files.map((a,u)=>new ae({...e[u],path:a,url:s+"/file="+a})):[]}))}async function gt(e,s){return e.map(t=>new ae({path:t.name,orig_name:t.name,blob:t,size:t.size,mime_type:t.type,is_stream:s}))}class ae{constructor({path:s,url:t,orig_name:r,size:n,blob:o,is_stream:i,mime_type:a,alt_text:u}){m(this,"path"),m(this,"url"),m(this,"orig_name"),m(this,"size"),m(this,"blob"),m(this,"is_stream"),m(this,"mime_type"),m(this,"alt_text"),m(this,"meta",{_type:"gradio.FileData"}),this.path=s,this.url=t,this.orig_name=r,this.size=n,this.blob=t?void 0:o,this.is_stream=i,this.mime_type=a,this.alt_text=u}}function pe(e,s,t){for(;t.length>1;){const n=t.shift();if(typeof n=="string"||typeof n=="number")e=e[n];else throw new Error("Invalid key type")}const r=t.shift();if(typeof r=="string"||typeof r=="number")e[r]=s;else throw new Error("Invalid key type")}async function ne(e,s=void 0,t=[],r=!1,n=void 0){if(Array.isArray(e)){let o=[];return await Promise.all(e.map(async(i,a)=>{var u;let c=t.slice();c.push(String(a));const d=await ne(e[a],r?((u=n?.parameters[a])==null?void 0:u.component)||void 0:s,c,!1,n);o=o.concat(d)})),o}else{if(globalThis.Buffer&&e instanceof globalThis.Buffer||e instanceof Blob)return[{path:t,blob:s==="Image"?!1:new ve([e]),type:s}];if(typeof e=="object"&&e!==null){let o=[];for(const i of Object.keys(e)){const a=[...t,i],u=e[i];o=o.concat(await ne(u,void 0,a,!1,n))}return o}}return[]}function Qe(e,s){var t,r;return((r=(t=s?.dependencies)==null?void 0:t[e])==null?void 0:r.queue)!==null?!s.dependencies[e].queue:!s.enable_queue}function Xe(e,s){return new Promise((t,r)=>{const n=new MessageChannel;n.port1.onmessage=({data:o})=>{n.port1.close(),t(o)},window.parent.postMessage(e,s,[n.port2])})}async function Ze(e,s,t){const r=this,n=await ne(s,void 0,[],!0,t);return(await Promise.all(n.map(async({path:i,blob:a,type:u})=>{if(!a)return{path:i,type:u};const c=await r.upload_files(e,[a]),d=c.files&&c.files[0];return{path:i,file_url:d,type:u,name:a instanceof File?a?.name:void 0}}))).forEach(({path:i,file_url:a,type:u,name:c})=>{if(u==="Gallery")pe(s,a,i);else if(a){const d=new ae({path:a,orig_name:c});pe(s,d,i)}}),s}async function et(e,s,t){const r={"Content-Type":"application/json"};this.options.hf_token&&(r.Authorization=`Bearer ${this.options.hf_token}`);try{var n=await this.fetch(e,{method:"POST",body:JSON.stringify(s),headers:{...r,...t}})}catch{return[{error:z},500]}let o,i;try{o=await n.json(),i=n.status}catch(a){o={error:`Could not parse server response: ${a}`},i=500}return[o,i]}async function tt(e,s){let t=!1,r=!1,n;if(!this.config)throw new Error("Could not resolve app config");if(typeof e=="number")n=this.config.dependencies[e];else{const o=e.replace(/^\//,"");n=this.config.dependencies[this.api_map[o]]}if(n?.types.continuous)throw new Error("Cannot call predict on this function as it may run forever. Use submit instead");return new Promise(async(o,i)=>{const a=this.submit(e,s);let u;a.on("data",c=>{r&&(a.destroy(),o(c)),t=!0,u=c}).on("status",c=>{c.stage==="error"&&i(c),c.stage==="complete"&&(r=!0,t&&(a.destroy(),o(u)))})})}async function re(e,s,t){let r=s==="subdomain"?`https://huggingface.co/api/spaces/by-subdomain/${e}`:`https://huggingface.co/api/spaces/${e}`,n,o;try{if(n=await fetch(r),o=n.status,o!==200)throw new Error;n=await n.json()}catch{t({status:"error",load_status:"error",message:Le,detail:"NOT_FOUND"});return}if(!n||o!==200)return;const{runtime:{stage:i},id:a}=n;switch(i){case"STOPPED":case"SLEEPING":t({status:"sleeping",load_status:"pending",message:"Space is asleep. Waking it up...",detail:i}),setTimeout(()=>{re(e,s,t)},1e3);break;case"PAUSED":t({status:"paused",load_status:"error",message:"This space has been paused by the author. If you would like to try this demo, consider duplicating the space.",detail:i,discussions_enabled:await he(a)});break;case"RUNNING":case"RUNNING_BUILDING":t({status:"running",load_status:"complete",message:"",detail:i});break;case"BUILDING":t({status:"building",load_status:"pending",message:"Space is building...",detail:i}),setTimeout(()=>{re(e,s,t)},1e3);break;default:t({status:"space_error",load_status:"error",message:"This space is experiencing an issue.",detail:i,discussions_enabled:await he(a)});break}}const st=/^(?=[^]*\b[dD]iscussions{0,1}\b)(?=[^]*\b[dD]isabled\b)[^]*$/;async function he(e){try{const t=(await fetch(`https://huggingface.co/api/spaces/${e}/discussions`,{method:"HEAD"})).headers.get("x-error-message");return!(t&&st.test(t))}catch{return!1}}async function nt(e,s){const t={};s&&(t.Authorization=`Bearer ${s}`);try{const r=await fetch(`https://huggingface.co/api/spaces/${e}/${je}`,{headers:t});if(r.status!==200)throw new Error("Space hardware could not be obtained.");const{hardware:n}=await r.json();return n.current}catch(r){throw new Error(r.message)}}async function rt(e,s,t){const r={};t&&(r.Authorization=`Bearer ${t}`);const n={seconds:s};try{const o=await fetch(`https://huggingface.co/api/spaces/${e}/${qe}`,{method:"POST",headers:{"Content-Type":"application/json",...r},body:JSON.stringify(n)});if(o.status!==200)throw new Error("Could not set sleep timeout on duplicated Space. Please visit *ADD HF LINK TO SETTINGS* to set a timeout manually to reduce billing charges.");return await o.json()}catch(o){throw new Error(o.message)}}const de=["cpu-basic","cpu-upgrade","cpu-xl","t4-small","t4-medium","a10g-small","a10g-large","a10g-largex2","a10g-largex4","a100-large","zero-a10g","h100","h100x8"];async function ot(e,s){const{hf_token:t,private:r,hardware:n,timeout:o}=s;if(n&&!de.includes(n))throw new Error(`Invalid hardware type provided. Valid types are: ${de.map(l=>`"${l}"`).join(",")}.`);const i={Authorization:`Bearer ${t}`,"Content-Type":"application/json"},a=(await(await fetch("https://huggingface.co/api/whoami-v2",{headers:i})).json()).name,u=e.split("/")[1],c={repository:`${a}/${u}`};r&&(c.private=!0);let d;try{n||(d=await nt(e,t))}catch(l){throw Error(Ue+l.message)}const p=n||d||"cpu-basic";c.hardware=p;try{const l=await fetch(`https://huggingface.co/api/spaces/${e}/duplicate`,{method:"POST",headers:i,body:JSON.stringify(c)});if(l.status===409)try{return await H.connect(`${a}/${u}`,s)}catch(w){throw console.error("Failed to connect Client instance:",w),w}else if(l.status!==200)throw new Error(l.statusText);const h=await l.json();return await rt(`${a}/${u}`,o||300,t),await H.connect(it(h.url),s)}catch(l){throw new Error(l)}}function it(e){const s=/https:\/\/huggingface.co\/spaces\/([^/]+\/[^/]+)/,t=e.match(s);if(t)return t[1]}async function at(){let{event_callbacks:e,unclosed_events:s,pending_stream_messages:t,stream_status:r,config:n,jwt:o}=this;if(!n)throw new Error("Could not resolve app config");r.open=!0;let i=null,a=new URLSearchParams({session_hash:this.session_hash}).toString(),u=new URL(`${n.root}/queue/data?${a}`);if(o&&u.searchParams.set("__sign",o),i=await this.stream(u),!i){console.warn("Cannot connect to SSE endpoint: "+u.toString());return}i.onmessage=async function(c){let d=JSON.parse(c.data);if(d.msg==="close_stream"){W(r,i);return}const p=d.event_id;if(!p)await Promise.all(Object.keys(e).map(l=>e[l](d)));else if(e[p]&&n){d.msg==="process_completed"&&["sse","sse_v1","sse_v2","sse_v2.1"].includes(n.protocol)&&(s.delete(p),s.size===0&&W(r,i));let l=e[p];typeof window<"u"?window.setTimeout(l,0,d):setImmediate(l,d)}else t[p]||(t[p]=[]),t[p].push(d)},i.onerror=async function(){await Promise.all(Object.keys(e).map(c=>e[c]({msg:"unexpected_error",message:z}))),W(r,i)}}function W(e,s){e&&s&&(e.open=!1,s?.close())}function ct(e,s,t){!e[s]?(e[s]=[],t.data.forEach((n,o)=>{e[s][o]=n})):t.data.forEach((n,o)=>{let i=lt(e[s][o],n);e[s][o]=i,t.data[o]=i})}function lt(e,s){return s.forEach(([t,r,n])=>{e=ut(e,r,t,n)}),e}function ut(e,s,t,r){if(s.length===0){if(t==="replace")return r;if(t==="append")return e+r;throw new Error(`Unsupported action: ${t}`)}let n=e;for(let i=0;i<s.length-1;i++)n=n[s[i]];const o=s[s.length-1];switch(t){case"replace":n[o]=r;break;case"append":n[o]+=r;break;case"add":Array.isArray(n)?n.splice(Number(o),0,r):n[o]=r;break;case"delete":Array.isArray(n)?n.splice(Number(o),1):delete n[o];break;default:throw new Error(`Unknown action: ${t}`)}return e}function pt(e,s,t,r){try{let n=function(y){const O=B[y.type]||[];O?.forEach(g=>g(y))},o=function(y,E){const O=B,g=O[y]||[];return O[y]=g,g?.push(E),{on:o,off:i,cancel:Q,destroy:a}},i=function(y,E){const O=B;let g=O[y]||[];return g=g?.filter(x=>x!==E),O[y]=g,{on:o,off:i,cancel:Q,destroy:a}},a=function(){var y;for(const E in B)B&&((y=B[E])==null||y.forEach(O=>{i(E,O)}))};const{hf_token:u}=this.options,{fetch:c,app_reference:d,config:p,session_hash:l,api_info:h,api_map:w,stream_status:b,pending_stream_messages:T,pending_diff_streams:M,event_callbacks:K,unclosed_events:Ee,post_data:V}=this;if(!h)throw new Error("No API found");if(!p)throw new Error("Could not resolve app config");let{fn_index:f,endpoint_info:$e,dependency:Ce}=ht(h,e,w,p),Oe=He(s,h),$,A,j=p.protocol??"ws";const _=typeof e=="number"?"/predict":e;let G,S=null,C=!1;const B={};let Y={},U=typeof window<"u"?new URLSearchParams(window.location.search).toString():"";async function Q(){const y={stage:"complete",queue:!1,time:new Date};C=y,n({...y,type:"status",endpoint:_,fn_index:f});let E={};j==="ws"?($&&$.readyState===0?$.addEventListener("open",()=>{$.close()}):$.close(),E={fn_index:f,session_hash:l}):(A?.close(),E={event_id:S});try{if(!p)throw new Error("Could not resolve app config");await c(`${p.root}/reset`,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify(E)})}catch{console.warn("The `/reset` endpoint could not be called. Subsequent endpoint results may be unreliable.")}}return this.handle_blob(p.root,Oe,$e).then(async y=>{var E;if(G={data:y||[],event_data:t,fn_index:f,trigger_id:r},Qe(f,p))n({type:"status",endpoint:_,stage:"pending",queue:!1,fn_index:f,time:new Date}),V(`${p.root}/run${_.startsWith("/")?_:`/${_}`}${U?"?"+U:""}`,{...G,session_hash:l}).then(([g,x])=>{const q=g.data;x==200?(n({type:"data",endpoint:_,fn_index:f,data:q,time:new Date,event_data:t,trigger_id:r}),n({type:"status",endpoint:_,fn_index:f,stage:"complete",eta:g.average_duration,queue:!1,time:new Date})):n({type:"status",stage:"error",endpoint:_,fn_index:f,message:g.error,queue:!1,time:new Date})}).catch(g=>{n({type:"status",stage:"error",message:g.message,endpoint:_,fn_index:f,queue:!1,time:new Date})});else if(j=="ws"){const{ws_protocol:g,host:x}=await ye(d,u);n({type:"status",stage:"pending",queue:!0,endpoint:_,fn_index:f,time:new Date});let q=new URL(`${g}://${ge(x,p.path,!0)}/queue/join${U?"?"+U:""}`);this.jwt&&q.searchParams.set("__sign",this.jwt),$=new WebSocket(q),$.onclose=R=>{R.wasClean||n({type:"status",stage:"error",broken:!0,message:z,queue:!0,endpoint:_,fn_index:f,time:new Date})},$.onmessage=function(R){const k=JSON.parse(R.data),{type:P,status:N,data:D}=se(k,Y[f]);if(P==="update"&&N&&!C)n({type:"status",endpoint:_,fn_index:f,time:new Date,...N}),N.stage==="error"&&$.close();else if(P==="hash"){$.send(JSON.stringify({fn_index:f,session_hash:l}));return}else P==="data"?$.send(JSON.stringify({...G,session_hash:l})):P==="complete"?C=N:P==="log"?n({type:"log",log:D.log,level:D.level,endpoint:_,fn_index:f}):P==="generating"&&n({type:"status",time:new Date,...N,stage:N?.stage,queue:!0,endpoint:_,fn_index:f});D&&(n({type:"data",time:new Date,data:D.data,endpoint:_,fn_index:f,event_data:t,trigger_id:r}),C&&(n({type:"status",time:new Date,...C,stage:N?.stage,queue:!0,endpoint:_,fn_index:f}),$.close()))},_e(p.version||"2.0.0","3.6")<0&&addEventListener("open",()=>$.send(JSON.stringify({hash:l})))}else if(j=="sse"){n({type:"status",stage:"pending",queue:!0,endpoint:_,fn_index:f,time:new Date});var O=new URLSearchParams({fn_index:f.toString(),session_hash:l}).toString();let g=new URL(`${p.root}/queue/join?${U?U+"&":""}${O}`);if(this.jwt&&g.searchParams.set("__sign",this.jwt),A=await this.stream(g),!A)return Promise.reject(new Error("Cannot connect to SSE endpoint: "+g.toString()));A.onmessage=async function(x){const q=JSON.parse(x.data),{type:R,status:k,data:P}=se(q,Y[f]);if(R==="update"&&k&&!C)n({type:"status",endpoint:_,fn_index:f,time:new Date,...k}),k.stage==="error"&&A?.close();else if(R==="data"){S=q.event_id;let[N,D]=await V(`${p.root}/queue/data`,{...G,session_hash:l,event_id:S});D!==200&&(n({type:"status",stage:"error",message:z,queue:!0,endpoint:_,fn_index:f,time:new Date}),A?.close())}else R==="complete"?C=k:R==="log"?n({type:"log",log:P.log,level:P.level,endpoint:_,fn_index:f}):R==="generating"&&n({type:"status",time:new Date,...k,stage:k?.stage,queue:!0,endpoint:_,fn_index:f});P&&(n({type:"data",time:new Date,data:P.data,endpoint:_,fn_index:f,event_data:t,trigger_id:r}),C&&(n({type:"status",time:new Date,...C,stage:k?.stage,queue:!0,endpoint:_,fn_index:f}),A?.close()))}}else if(j=="sse_v1"||j=="sse_v2"||j=="sse_v2.1"||j=="sse_v3"){n({type:"status",stage:"pending",queue:!0,endpoint:_,fn_index:f,time:new Date});let g="";typeof window<"u"&&(g=(E=window?.location)==null?void 0:E.hostname);const q=g.includes(".dev.")?`https://moon-${g.split(".")[1]}.dev.spaces.huggingface.tech`:"https://huggingface.co",R=typeof window<"u"&&window.parent!=window,k=Ce.zerogpu&&p.space_id;(R&&k?Xe("zerogpu-headers",q):Promise.resolve(null)).then(D=>V(`${p.root}/queue/join?${U}`,{...G,session_hash:l},D)).then(async([D,ce])=>{if(ce===503)n({type:"status",stage:"error",message:me,queue:!0,endpoint:_,fn_index:f,time:new Date});else if(ce!==200)n({type:"status",stage:"error",message:z,queue:!0,endpoint:_,fn_index:f,time:new Date});else{S=D.event_id;let le=async function(X){try{const{type:L,status:v,data:I}=se(X,Y[f]);if(L=="heartbeat")return;if(L==="update"&&v&&!C)n({type:"status",endpoint:_,fn_index:f,time:new Date,...v});else if(L==="complete")C=v;else if(L=="unexpected_error")console.error("Unexpected error",v?.message),n({type:"status",stage:"error",message:v?.message||"An Unexpected Error Occurred!",queue:!0,endpoint:_,fn_index:f,time:new Date});else if(L==="log"){n({type:"log",log:I.log,level:I.level,endpoint:_,fn_index:f});return}else L==="generating"&&(n({type:"status",time:new Date,...v,stage:v?.stage,queue:!0,endpoint:_,fn_index:f}),I&&["sse_v2","sse_v2.1","sse_v3"].includes(j)&&ct(M,S,I));I&&(n({type:"data",time:new Date,data:I.data,endpoint:_,fn_index:f}),I.render_config&&n({type:"render",data:I.render_config,endpoint:_,fn_index:f}),C&&n({type:"status",time:new Date,...C,stage:v?.stage,queue:!0,endpoint:_,fn_index:f})),(v?.stage==="complete"||v?.stage==="error")&&(K[S]&&delete K[S],S in M&&delete M[S])}catch(L){console.error("Unexpected client exception",L),n({type:"status",stage:"error",message:"An Unexpected Error Occurred!",queue:!0,endpoint:_,fn_index:f,time:new Date}),["sse_v2","sse_v2.1"].includes(j)&&(W(b,A),b.open=!1)}};S in T&&(T[S].forEach(X=>le(X)),delete T[S]),K[S]=le,Ee.add(S),b.open||await this.open_stream()}})}}),{on:o,off:i,cancel:Q,destroy:a}}catch(n){throw console.error("Submit function encountered an error:",n),n}}function ht(e,s,t,r){let n,o,i;if(typeof s=="number")n=s,o=e.unnamed_endpoints[n],i=r.dependencies[s];else{const a=s.replace(/^\//,"");n=t[a],o=e.named_endpoints[s.trim()],i=r.dependencies[t[a]]}if(typeof n!="number")throw new Error("There is no endpoint matching that name of fn_index matching that number.");return{fn_index:n,endpoint_info:o,dependency:i}}class ve extends Blob{constructor(s,t){super(s,t)}}class H{constructor(s,t={}){m(this,"app_reference"),m(this,"options"),m(this,"config"),m(this,"api_info"),m(this,"api_map",{}),m(this,"session_hash",Math.random().toString(36).substring(2)),m(this,"jwt",!1),m(this,"last_status",{}),m(this,"stream_status",{open:!1}),m(this,"pending_stream_messages",{}),m(this,"pending_diff_streams",{}),m(this,"event_callbacks",{}),m(this,"unclosed_events",new Set),m(this,"heartbeat_event",null),m(this,"view_api"),m(this,"upload_files"),m(this,"upload"),m(this,"handle_blob"),m(this,"post_data"),m(this,"submit"),m(this,"predict"),m(this,"open_stream"),m(this,"resolve_config"),this.app_reference=s,this.options=t,this.view_api=Ke.bind(this),this.upload_files=Ve.bind(this),this.handle_blob=Ze.bind(this),this.post_data=et.bind(this),this.submit=pt.bind(this),this.predict=tt.bind(this),this.open_stream=at.bind(this),this.resolve_config=Fe.bind(this),this.upload=Ye.bind(this)}fetch(s,t){return fetch(s,t)}async stream(s){if(typeof window>"u"||typeof EventSource>"u")try{const t=await J(()=>import("./eventsource-CfQQVHjX.js").then(r=>r.e),__vite__mapDeps([0,1,2,3]),import.meta.url);return new t.default(s.toString())}catch(t){throw console.error("Failed to load EventSource module:",t),t}else return new EventSource(s.toString())}async init(){var s;if((typeof window>"u"||!("WebSocket"in window))&&!global.WebSocket){const t=await J(()=>import("./wrapper-CviSselG-DCvi549i.js"),__vite__mapDeps([4,3]),import.meta.url);ve=(await J(()=>import("./__vite-browser-external-DFe-p4yY.js").then(r=>r._),[],import.meta.url)).Blob,global.WebSocket=t.WebSocket}try{await this._resolve_config().then(async({config:t})=>{if(this.config=t,t.space_id&&this.options.hf_token&&(this.jwt=await ze(t.space_id,this.options.hf_token)),this.config&&this.config.connect_heartbeat){const r=new URL(`${this.config.root}/heartbeat/${this.session_hash}`);this.jwt&&r.searchParams.set("__sign",this.jwt),this.heartbeat_event=await this.stream(r)}})}catch(t){throw Error(F+t.message)}this.api_info=await this.view_api(),this.api_map=Be(((s=this.config)==null?void 0:s.dependencies)||[])}static async connect(s,t={}){const r=new this(s,t);return await r.init(),r}close(){var s;(s=this.heartbeat_event)==null||s.close()}static async duplicate(s,t={}){return ot(s,t)}async _resolve_config(){const{http_protocol:s,host:t,space_id:r}=await ye(this.app_reference,this.options.hf_token),{status_callback:n}=this.options;let o;try{if(o=await this.resolve_config(`${s}//${t}`),!o)throw new Error(F);return this.config_success(o)}catch(i){console.error(i),r?re(r,we.test(r)?"space_name":"subdomain",this.handle_space_success):n&&n({status:"error",message:"Could not load this space.",load_status:"error",detail:"NOT_FOUND"})}}async config_success(s){if(this.config=s,typeof window<"u"&&window.location.protocol==="https:"&&(this.config.root=this.config.root.replace("http://","https://")),this.config.auth_required)return this.prepare_return_obj();try{this.api_info=await this.view_api()}catch(t){console.error(Ie+t.message)}return this.prepare_return_obj()}async handle_space_success(s){const{status_callback:t}=this.options;if(t&&t(s),s.status==="running")try{if(this.config=await this._resolve_config(),!this.config)throw new Error(F);return await this.config_success(this.config)}catch(r){console.error(r),t&&t({status:"error",message:"Could not load this space.",load_status:"error",detail:"NOT_FOUND"})}}async component_server(s,t,r){var n;if(!this.config)throw new Error(F);const o={},{hf_token:i}=this.options,{session_hash:a}=this;i&&(o.Authorization=`Bearer ${this.options.hf_token}`);let u,c=this.config.components.find(p=>p.id===s);(n=c?.props)!=null&&n.root_url?u=c.props.root_url:u=this.config.root;let d;if("binary"in r){d=new FormData;for(const p in r.data)p!=="binary"&&d.append(p,r.data[p]);d.set("component_id",s.toString()),d.set("fn_name",t),d.set("session_hash",a)}else d=JSON.stringify({data:r,component_id:s,fn_name:t,session_hash:a}),o["Content-Type"]="application/json";i&&(o.Authorization=`Bearer ${i}`);try{const p=await this.fetch(`${u}/component_server/`,{method:"POST",body:d,headers:o});if(!p.ok)throw new Error("Could not connect to component server: "+p.statusText);return await p.json()}catch(p){console.warn(p)}}prepare_return_obj(){return{config:this.config,predict:this.predict,submit:this.submit,view_api:this.view_api,component_server:this.component_server}}}let be=!1;"attachShadow"in Element.prototype&&"adoptedStyleSheets"in Document.prototype&&(be="adoptedStyleSheets"in document.createElement("div").attachShadow({mode:"open"}));function fe(e,s){const t=new URL(import.meta.url).origin,r=new URL(e,t).href;if(document.querySelector(`link[href='${r}']`))return Promise.resolve();const o=document.createElement("link");return o.rel="stylesheet",o.href=r,new Promise((i,a)=>{o.addEventListener("load",()=>i()),o.addEventListener("error",()=>{console.error(`Unable to preload CSS for ${r}`),i()}),s.appendChild(o)})}function wt(e,s,t=document.createElement("style")){if(!be)return null;t.remove();const r=new CSSStyleSheet;r.replaceSync(e);let n="";e=e.replace(/@import\s+url\((.*?)\);\s*/g,(u,c)=>(n+=`@import url(${c});
`,""));const o=r.cssRules;let i="",a=`gradio-app .gradio-container.gradio-container-${s} .contain `;for(let u=0;u<o.length;u++){const c=o[u];let d=c.cssText.includes(".dark");if(c instanceof CSSStyleRule){const p=c.selectorText;if(p){const l=p.replace(".dark","").split(",").map(h=>`${d?".dark":""} ${a} ${h.trim()} `).join(",");i+=c.cssText,i+=c.cssText.replace(p,l)}}else if(c instanceof CSSMediaRule){let p=`@media ${c.media.mediaText} {`;for(let l=0;l<c.cssRules.length;l++){const h=c.cssRules[l];if(h instanceof CSSStyleRule){let w=h.cssText.includes(".dark ");const b=h.selectorText,T=b.replace(".dark","").split(",").map(M=>`${w?".dark":""} ${a} ${M.trim()} `).join(",");p+=h.cssText.replace(b,T)}}p+="}",i+=p}else if(c instanceof CSSKeyframesRule){i+=`@keyframes ${c.name} {`;for(let p=0;p<c.cssRules.length;p++){const l=c.cssRules[p];l instanceof CSSKeyframeRule&&(i+=`${l.keyText} { ${l.style.cssText} }`)}i+="}"}else c instanceof CSSFontFaceRule&&(i+=`@font-face { ${c.style.cssText} }`)}return i=n+i,t.textContent=i,document.head.appendChild(t),t}const dt="./assets/index-Bkcit_x4.css";let oe;oe=[];let ie,Se,ft=new Promise(e=>{Se=e});async function _t(){ie=(await J(()=>import("./Index-CLipTJLN.js").then(e=>e.f),__vite__mapDeps([5,1,6]),import.meta.url)).default,Se()}function mt(){const e={SvelteComponent:Z.SvelteComponent};for(const t in Z)t!=="SvelteComponent"&&(t==="SvelteComponentDev"?e[t]=e.SvelteComponent:e[t]=Z[t]);window.__gradio__svelte__internal=e;class s extends HTMLElement{constructor(){super(),this.host=this.getAttribute("host"),this.space=this.getAttribute("space"),this.src=this.getAttribute("src"),this.control_page_title=this.getAttribute("control_page_title"),this.initial_height=this.getAttribute("initial_height")??"300px",this.is_embed=this.getAttribute("embed")??"true",this.container=this.getAttribute("container")??"true",this.info=this.getAttribute("info")??!0,this.autoscroll=this.getAttribute("autoscroll"),this.eager=this.getAttribute("eager"),this.theme_mode=this.getAttribute("theme_mode"),this.updating=!1,this.loading=!1}async connectedCallback(){await _t(),this.loading=!0,this.app&&this.app.$destroy(),typeof oe!="string"&&oe.forEach(o=>fe(o,document.head)),await fe(dt,document.head);const r=new CustomEvent("domchange",{bubbles:!0,cancelable:!1,composed:!0});new MutationObserver(o=>{this.dispatchEvent(r)}).observe(this,{childList:!0}),this.app=new ie({target:this,props:{space:this.space?this.space.trim():this.space,src:this.src?this.src.trim():this.src,host:this.host?this.host.trim():this.host,info:this.info!=="false",container:this.container!=="false",is_embed:this.is_embed!=="false",initial_height:this.initial_height,eager:this.eager==="true",version:"4-31-5",theme_mode:this.theme_mode,autoscroll:this.autoscroll==="true",control_page_title:this.control_page_title==="true",Client:H,app_mode:window.__gradio_mode__==="app"}}),this.updating&&this.setAttribute(this.updating.name,this.updating.value),this.loading=!1}static get observedAttributes(){return["src","space","host"]}async attributeChangedCallback(r,n,o){if(await ft,(r==="host"||r==="space"||r==="src")&&o!==n){if(this.updating={name:r,value:o},this.loading)return;this.app&&this.app.$destroy(),this.space=null,this.host=null,this.src=null,r==="host"?this.host=o:r==="space"?this.space=o:r==="src"&&(this.src=o),this.app=new ie({target:this,props:{space:this.space?this.space.trim():this.space,src:this.src?this.src.trim():this.src,host:this.host?this.host.trim():this.host,info:this.info!=="false",container:this.container!=="false",is_embed:this.is_embed!=="false",initial_height:this.initial_height,eager:this.eager==="true",version:"4-31-5",theme_mode:this.theme_mode,autoscroll:this.autoscroll==="true",control_page_title:this.control_page_title==="true",Client:H,app_mode:window.__gradio_mode__==="app"}}),this.updating=!1}}}customElements.get("gradio-app")||customElements.define("gradio-app",s)}mt();export{J as _,wt as a,fe as m,gt as p};
//# sourceMappingURL=index-Cr9C6grF.js.map
